---
title: "What is the Role of Fertilizer in Strawberry Cultivation?"
author: "Yuan Wang"
format: pdf
editor: visual
---

```{r, message=FALSE, warning=FALSE}
# https://quickstats.nass.usda.gov/
library(tidyverse)
library(tidyr)
library(stringr)
library(knitr)
library(dplyr)
library(lubridate)
```

```{r}
f <- read.csv("fertilizers.csv")
```

```{r}
# Column exploration 
fertilizer <- f |> 
  select(where(~ !(all(is.na(.x)) || length(unique(na.omit(.x))) == 1)))
```

```{r}
#| label: data cleaning

fertilizer <- fertilizer |>
  rename(Fertilizer = Domain.Category)

fertilizer <- fertilizer |>
  mutate(Fertilizer = str_extract(Fertilizer, "\\(([^)]+)\\)") |>
                           str_replace_all("[()]", ""))

fertilizer$Data.Item <- fertilizer$Data.Item |>
  str_remove("^STRAWBERRIES, BEARING - ")

fertilizer$Value <- str_replace(fertilizer$Value, "(D)", "NA")

#unique(fertilizer$State)

fertilizer <- fertilizer |> 
  separate("Data.Item", 
           into = c("Metric", "Units"), 
           sep = ", MEASURED IN ",
           remove = FALSE)
```

```{r}
#| label: explore organization

# What are the proportions of Applications vs Treated?
fertilizer_metric <- fertilizer |>
  group_by(State) |>
  count(Metric) |>
  mutate(Proportion = n/sum(n)) |>
  rename(Count = n)

applications <- fertilizer |>
  filter(Metric == "APPLICATIONS")

treated <- fertilizer |> 
  filter(Metric == "TREATED")

fertilizer$Value <- as.numeric(gsub(",", "", fertilizer$Value))

# # Pivot Wider
# fertilizer <- fertilizer |>
#   pivot_wider()
# 
# ?pivot_wider
```

## Topic: Explore Fertilizer Use in Strawberry Cultivation.

Exploratory Questions:

1.  Why is fertilizer important?
    -   <https://www.yara.com/knowledge-grows/five-important-facts-about-fertilizers/>

        -   Nitrogen fertilizer was created by Sam Eyde and Kristian Birkeland in December of 1905. This has changed agriculture and contributed to the high crop yields of today. The possibility of feeding the growing population of the world is thanks to fertilizer improvements. The critical plant nutrients are the macronutrients nitrogen, phosphorus, potassium, calcium, sulphur, magnesium, oxygen, hydrogen, carbon, and the micronutrients iron, boron, chlorine, manganese, zinc, copper, molybdenum and nickel. Planting crops depletes the soil, and the fertilizers replenish them to ensure that future crops have a good foundation for growth.

        -   "The most common sources of nutrients in mineral fertilizers are nitrogen, potassium and phosphate."
2.  What are the most used fertilizers by state, based on the data set?
    -   Answer: From the fertilizer_state data we can see that many fertilizers are used equally as often. Nitrogen, Phosphate, and Potash (Potassium) seem to be used an equal amount of times across the different states in the data set. This aligns with the information from the Yara website.

```{r}
fertilizer_state <- fertilizer |>
  group_by(State) |>
  count(Fertilizer) |>
  rename(Count = n)

ggplot(fertilizer_state, aes(x = State, y = Count, fill = Fertilizer))+
  
```

3.  
